generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model accounts {
  id                  String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id             String    @db.Uuid
  type                String    @db.VarChar(255)
  provider            String    @db.VarChar(255)
  provider_account_id String    @db.VarChar(255)
  refresh_token       String?
  access_token        String?
  expires_at          Int?
  token_type          String?   @db.VarChar(255)
  scope               String?
  id_token            String?
  session_state       String?
  created_at          DateTime? @default(now()) @db.Timestamptz(6)
  updated_at          DateTime? @default(now()) @db.Timestamptz(6)
  users               users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([provider, provider_account_id])
  @@index([user_id], map: "idx_accounts_user_id")
}

model campaign_comments {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  campaign_id String    @db.Uuid
  user_id     String    @db.Uuid
  content     String
  created_at  DateTime? @default(now()) @db.Timestamptz(6)
  updated_at  DateTime? @default(now()) @db.Timestamptz(6)
  campaigns   campaigns @relation(fields: [campaign_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users       users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([campaign_id], map: "idx_comments_campaign_id")
  @@index([user_id], map: "idx_comments_user_id")
}

model campaign_followers {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  campaign_id String    @db.Uuid
  user_id     String    @db.Uuid
  created_at  DateTime? @default(now()) @db.Timestamptz(6)
  campaigns   campaigns @relation(fields: [campaign_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users       users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([campaign_id, user_id])
  @@index([campaign_id], map: "idx_followers_campaign_id")
  @@index([user_id], map: "idx_followers_user_id")
}

model campaigns {
  id                   String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  startup_profile_id   String               @db.Uuid
  title                String               @db.VarChar(255)
  description          String?
  vsl_url              String?
  pitch_deck           String?
  current_raised       Decimal?             @default(0) @db.Decimal(15, 2)
  max_investment       Decimal?             @db.Decimal(15, 2)
  status               String?              @default("draft") @db.VarChar(50)
  published_at         DateTime?            @db.Timestamptz(6)
  closes_at            DateTime?            @db.Timestamptz(6)
  view_count           Int?                 @default(0)
  interested_investors Int?                 @default(0)
  created_at           DateTime?            @default(now()) @db.Timestamptz(6)
  updated_at           DateTime?            @default(now()) @db.Timestamptz(6)
  campaign_objective   String?              @db.VarChar
  campaign_comments    campaign_comments[]
  campaign_followers   campaign_followers[]
  startup_profiles     startup_profiles     @relation(fields: [startup_profile_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  investments          investments[]
  watchlists           watchlists[]

  @@index([published_at], map: "idx_campaigns_published_at")
  @@index([startup_profile_id], map: "idx_campaigns_startup_id")
  @@index([status], map: "idx_campaigns_status")
}

model investments {
  id                       String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  campaign_id              String             @db.Uuid
  investor_profile_id      String             @db.Uuid
  amount                   Decimal            @db.Decimal(15, 2)
  status                   investment_status? @default(PENDING)
  stripe_payment_intent_id String?            @db.VarChar(255)
  escrow_released          Boolean?           @default(false)
  accepted_at              DateTime?          @db.Timestamptz(6)
  completed_at             DateTime?          @db.Timestamptz(6)
  created_at               DateTime?          @default(now()) @db.Timestamptz(6)
  updated_at               DateTime?          @default(now()) @db.Timestamptz(6)
  campaigns                campaigns          @relation(fields: [campaign_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  investor_profiles        investor_profiles  @relation(fields: [investor_profile_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([campaign_id], map: "idx_investments_campaign_id")
  @@index([investor_profile_id], map: "idx_investments_investor_id")
  @@index([status], map: "idx_investments_status")
}

model investor_preferences {
  id                     String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  investor_profile_id    String            @unique @db.Uuid
  min_roi_threshold      Decimal?          @db.Decimal(5, 2)
  preferred_stages       String?
  sector_filters         String?
  geographic_preferences String?
  created_at             DateTime?         @default(now()) @db.Timestamptz(6)
  updated_at             DateTime?         @default(now()) @db.Timestamptz(6)
  investor_profiles      investor_profiles @relation(fields: [investor_profile_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model investor_profiles {
  id                     String                @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId                 String                @unique(map: "investor_profiles_user_id_key") @db.Uuid
  investorType           String?               @db.VarChar(50)
  investmentTypes        Json?
  ticketRange            String?               @db.VarChar(50)
  investment_stages      Json?
  sector_focus           Json?
  geoFocus               Json?                 @default("[\"UAE\"]")
  roiPriorities          Json?
  profile_visibility     String?               @default("visible") @db.VarChar(50)
  isAccredited           Boolean?              @default(false)
  professional_title     String?
  investment_focus       String?
  ticket_size            String?               @db.VarChar(50)
  accreditation_status   verification_status?  @default(PENDING)
  accreditation_document String?
  stripe_customer_id     String?               @db.VarChar(255)
  stripe_account_id      String?               @db.VarChar(255)
  created_at             DateTime?             @default(now()) @db.Timestamptz(6)
  updatedAt              DateTime?             @default(now()) @db.Timestamptz(6)
  onboardingComplete     String?
  preferredSectors       String?
  preferredStages        String?
  profileVisibility      String?
  investments            investments[]
  investor_preferences   investor_preferences?
  users                  users                 @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  watchlists             watchlists[]

  @@index([userId], map: "idx_investor_profiles_user_id")
}

model sessions {
  id            String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  session_token String    @unique @db.VarChar(255)
  user_id       String    @db.Uuid
  expires       DateTime  @db.Timestamptz(6)
  created_at    DateTime? @default(now()) @db.Timestamptz(6)
  users         users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([session_token], map: "idx_sessions_token")
  @@index([user_id], map: "idx_sessions_user_id")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model startup_metrics {
  id                           String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  startup_profile_id           String           @db.Uuid
  MRR_now                      Decimal?         @db.Decimal(12, 2)
  MRR_prev                     Decimal?         @db.Decimal(12, 2)
  ARR                          Decimal?         @db.Decimal(12, 2)
  churn_rate                   Decimal?         @db.Decimal(5, 2)
  active_customers             Int?
  returningUsers_              Int?             @map("returningUsers%")
  AI_model__boolean_           Boolean?         @map("AI model (boolean)")
  followers_count              Int?
  team_years_experience        Int?
  mentions_count               Int?
  created_at                   DateTime?        @default(now()) @db.Timestamptz(6)
  updated_at                   DateTime?        @default(now()) @db.Timestamptz(6)
  HR__boolean_                 Boolean?         @default(false) @map("HR (boolean)")
  FINANCE__boolean_            Boolean?         @default(false) @map("FINANCE (boolean)")
  LAW__boolean_                Boolean?         @default(false) @map("LAW (boolean)")
  COMPLIANCE__boolean_         Boolean?         @default(false) @map("COMPLIANCE (boolean)")
  ALL__boolean_                Boolean?         @default(false) @map("ALL (boolean)")
  OPERATIONS__boolean_         Boolean?         @default(false) @map("OPERATIONS (boolean)")
  OTHER___boolean_             Boolean?         @default(false) @map("OTHER? (boolean)")
  Speed_Productivity__boolean_ Boolean?         @default(false) @map("Speed/Productivity (boolean)")
  Accuracy__boolean_           Boolean?         @default(false) @map("Accuracy (boolean)")
  Cost_Reduction__boolean_     Boolean?         @default(false) @map("Cost Reduction (boolean)")
  Decision_Making__boolean_    Boolean?         @default(false) @map("Decision-Making (boolean)")
  engagementRate               Decimal?         @db.Decimal
  activeUsers_now              Int?
  activeUsers_prev             Int?
  operational_costs            Decimal?         @db.Decimal
  Investments                  Decimal?         @db.Decimal
  Consolidated_AI_Impact       Decimal?         @db.Decimal
  AI_Impact_Startup_i          Decimal?         @db.Decimal
  Financial_i                  Decimal?         @db.Decimal
  Technology_i                 Decimal?         @db.Decimal
  Industry_i                   Decimal?         @db.Decimal
  Social_i                     Decimal?         @db.Decimal
  startup_profiles             startup_profiles @relation(fields: [startup_profile_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([startup_profile_id], map: "idx_startup_metrics_startup_id")
}

model startup_profiles {
  id                       String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId                   String               @unique(map: "startup_profiles_user_id_key") @db.Uuid
  companyName              String               @db.VarChar(255)
  logo                     String?
  industry                 String               @db.VarChar(100)
  stage                    String               @db.VarChar(50)
  description              String?
  website                  String?              @db.VarChar(255)
  geographicPresence       String?              @db.VarChar(100)
  dataMigrationMethod      String?              @db.VarChar(50)
  kyc_status               verification_status? @default(PENDING)
  business_license         String?
  founder_id_document      String?
  profile_completion_score Int?                 @default(0)
  created_at               DateTime?            @default(now()) @db.Timestamptz(6)
  updatedAt                DateTime?            @default(now()) @db.Timestamptz(6)
  onboardingComplete       String?
  campaigns                campaigns[]
  startup_metrics          startup_metrics[]
  users                    users                @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([industry], map: "idx_startup_profiles_industry")
  @@index([stage], map: "idx_startup_profiles_stage")
  @@index([userId], map: "idx_startup_profiles_user_id")
}

model subscriptions {
  id                        String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id                   String            @unique @db.Uuid
  tier                      subscription_tier
  stripe_subscription_id    String?           @db.VarChar(255)
  stripe_customer_id        String?           @db.VarChar(255)
  stripe_price_id           String?           @db.VarChar(255)
  stripe_current_period_end DateTime?         @db.Timestamptz(6)
  current_period_end        DateTime?         @db.Timestamptz(6)
  status                    String?           @default("active") @db.VarChar(50)
  created_at                DateTime?         @default(now()) @db.Timestamptz(6)
  updated_at                DateTime?         @default(now()) @db.Timestamptz(6)
  users                     users             @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model users {
  id                 String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  emailVerified      String               @unique(map: "users_email_key") @db.VarChar(255)
  password           String?              @db.VarChar(255)
  role               user_role?           @default(INVESTOR)
  name               String?              @db.VarChar(255)
  email_verified     DateTime?            @db.Timestamptz(6)
  image              String?
  createdAt          DateTime?            @default(now()) @db.Timestamptz(6)
  updatedAt          DateTime?            @default(now()) @db.Timestamptz(6)
  email              String?
  accounts           accounts[]
  campaign_comments  campaign_comments[]
  campaign_followers campaign_followers[]
  investor_profiles  investor_profiles?
  sessions           sessions[]
  startup_profiles   startup_profiles?
  subscriptions      subscriptions?

  @@index([emailVerified], map: "idx_users_email")
  @@index([role], map: "idx_users_role")
}

model verification_tokens {
  identifier String   @db.VarChar(255)
  token      String   @unique @db.VarChar(255)
  expires    DateTime @db.Timestamptz(6)

  @@id([identifier, token])
}

model watchlists {
  id                     String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  investor_profile_id    String            @db.Uuid
  campaign_id            String            @db.Uuid
  alert_on_metric_change Boolean?          @default(true)
  created_at             DateTime?         @default(now()) @db.Timestamptz(6)
  campaigns              campaigns         @relation(fields: [campaign_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  investor_profiles      investor_profiles @relation(fields: [investor_profile_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([investor_profile_id, campaign_id])
  @@index([campaign_id], map: "idx_watchlists_campaign_id")
  @@index([investor_profile_id], map: "idx_watchlists_investor_id")
}

enum data_verification_level {
  VERIFIED
  PARTIALLY_VERIFIED
  SELF_REPORTED
}

enum investment_status {
  PENDING
  ACCEPTED
  REJECTED
  COMPLETED
  CANCELLED
}

enum subscription_tier {
  STARTUP_BASIC
  INVESTOR_BASIC
  STARTUP_PRO
  INVESTOR_PRO
}

enum user_role {
  STARTUP
  INVESTOR
  ADMIN
}

enum verification_status {
  PENDING
  VERIFIED
  REJECTED
}
